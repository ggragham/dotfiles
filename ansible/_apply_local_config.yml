---
- name: Backup and apply dotfiles
  command:
    cmd: bash {{ script_path }}/_load_dotfiles.sh
    creates: /home/{{ user }}/.alias_zsh
# TODO: make this script as module
- name: Backup and apply dconf
  block:
    - name: DE name
      set_fact:
        de_name: '{{ ansible_env.XDG_CURRENT_DESKTOP | lower }}'
    - name: Get dconf path
      set_fact:
        dconf_path: '{{ repo_root_path }}/{{ de_name }}.dconf'
    - name: Dconf
      block:
        - name: Backup dconf
          shell:
            cmd: |
              currentTimestamp="$(date +'%d_%m_%Y_%H_%M_%S')"
              dconf dump / >"${BACKUP_PATH}/${DE_NAME}_${currentTimestamp}.dconf"
          environment:
            DE_NAME: '{{ de_name }}'
            BACKUP_PATH: '{{ backup_path }}'
        - name: Load dconf
          shell:
            cmd: dconf load / <"{{ dconf_path }}"
          environment:
            DBUS_SESSION_BUS_ADDRESS: unix:path=/run/user/{{ uid }}/bus
      when: (de_name=='gnome') or (de_name=='mate')
  when: ( ansible_env.XDG_CURRENT_DESKTOP is defined )
- name: Download some scripts
  get_url:
    url: https://raw.githubusercontent.com/ggragham/just_bunch_of_scripts/master/bin/{{ item }}
    dest: '{{ local_bin_path }}/'
    mode: 0700
  with_items: [weather, getip]
